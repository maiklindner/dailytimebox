<!DOCTYPE html>
<html>

<head>
  <title>Timebox</title>
  <link rel="icon" type="image/svg" sizes="16x16" href="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pjxzdmcgdmlld0JveD0iMCAwIDY0IDY0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxkZWZzPjxzdHlsZT4uY2xzLTF7ZmlsbDojZmZhYjAwO30uY2xzLTJ7ZmlsbDojZWZjNTg5O30uY2xzLTN7ZmlsbDojM2UyYzI3O30uY2xzLTR7ZmlsbDojYmQ3ZjAwO30uY2xzLTV7ZmlsbDojMmQyZDJkO308L3N0eWxlPjwvZGVmcz48dGl0bGUvPjxnIGlkPSJnaXJhZmZlIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik00NywyN3Y1TDQxLDUxdjRhNiw2LDAsMCwxLTYsNkgyOWE2LDYsMCwwLDEtNi02VjUxTDE3LDMyVjI3YzAtLjI2LDAtLjUyLDAtLjc4QTEzLjg2LDEzLjg2LDAsMCwxLDE4Ljg4LDIwYTE0LjE1LDE0LjE1LDAsMCwxLDIuODYtMy40OSwzLDMsMCwwLDAsLjI1LS4yNUEzLjk0LDMuOTQsMCwwLDAsMjIuNjUsMTJMMjEuMzIsOWMtLjExLDAtLjIxLDAtLjMyLDBhMywzLDAsMSwxLC40Mi02QTMsMywwLDAsMSwyMy45LDUuMjYsMi45NCwyLjk0LDAsMCwxLDI0LDYuNDNhNCw0LDAsMCwwLC4yMywyLjI2bDEuMjMsMi43OGEzLDMsMCwwLDAsMy4yMiwxLjczQTEzLjI5LDEzLjI5LDAsMCwxLDMwLjIxLDEzaDMuNThhMTMuMjksMTMuMjksMCwwLDEsMS41Ni4xNywzLDMsMCwwLDAsMy4yMi0xLjczbDEuMTktMi42OUE0LjM2LDQuMzYsMCwwLDAsNDAsNi4zOCwyLjM0LDIuMzQsMCwwLDEsNDAsNmEzLDMsMCwxLDEsMywzYy0uMTEsMC0uMjEsMC0uMzIsMGwtMS4zMywzQTMuOTQsMy45NCwwLDAsMCw0MiwxNi4yNmwuMjUuMjVBMTQuMTUsMTQuMTUsMCwwLDEsNDUuMTIsMjAsMTMuODYsMTMuODYsMCwwLDEsNDcsMjYuMjJDNDcsMjYuNDgsNDcsMjYuNzQsNDcsMjdaIi8+PHJlY3QgY2xhc3M9ImNscy0yIiBoZWlnaHQ9IjE0IiByeD0iNiIgcnk9IjYiIHdpZHRoPSIxOCIgeD0iMjMiIHk9IjQ3Ii8+PHBhdGggY2xhc3M9ImNscy0zIiBkPSJNMjksNTZhMSwxLDAsMCwxLTEtMVY1M2ExLDEsMCwwLDEsMiwwdjJBMSwxLDAsMCwxLDI5LDU2WiIvPjxwYXRoIGNsYXNzPSJjbHMtMyIgZD0iTTM1LDU2YTEsMSwwLDAsMS0xLTFWNTNhMSwxLDAsMCwxLDIsMHYyQTEsMSwwLDAsMSwzNSw1NloiLz48cGF0aCBjbGFzcz0iY2xzLTQiIGQ9Ik01NywyOUg1NWExMi45MSwxMi45MSwwLDAsMS04LTIuNzhBMTMuODYsMTMuODYsMCwwLDAsNDUuMTIsMjBhMTQuMTUsMTQuMTUsMCwwLDAtMi44Ni0zLjQ5TDQyLDE2LjI2QTIuMjYsMi4yNiwwLDAsMSw0MiwxNmgyQTEzLDEzLDAsMCwxLDU3LDI5WiIvPjxwYXRoIGNsYXNzPSJjbHMtNCIgZD0iTTIyLDE2YTIuMjYsMi4yNiwwLDAsMSwwLC4yNiwzLDMsMCwwLDEtLjI1LjI1QTE0LjE1LDE0LjE1LDAsMCwwLDE4Ljg4LDIwLDEzLjg2LDEzLjg2LDAsMCwwLDE3LDI2LjIyLDEyLjkxLDEyLjkxLDAsMCwxLDksMjlIN0ExMywxMywwLDAsMSwyMCwxNloiLz48Y2lyY2xlIGNsYXNzPSJjbHMtNSIgY3g9IjM4LjUiIGN5PSIzMi41IiByPSIxLjUiLz48Y2lyY2xlIGNsYXNzPSJjbHMtNSIgY3g9IjI1LjUiIGN5PSIzMi41IiByPSIxLjUiLz48L2c+PC9zdmc+" />
  <style>
    body {
      color: rgb(49, 23, 31);
      font-family: sans-serif;
      font-size: 5vh;
      padding: 5%;
    }
    #content {
      margin: auto;
      white-space: nowrap;
    }
    #head {
      color: rgb(234, 0, 41);
      float:left;
    }
    #inp {
      float:right;
      color: rgb(100, 170, 178);
    }
    #inpMaxTime {
      border: 1px solid transparent;
      color: rgb(47, 124, 133);
      font-size: 1em;
      font-weight: bold;
      text-align: right;
      width: 3em;
    }
    #inpMaxTime:hover {
      border: 1px solid rgb(100, 170, 178);
    }
    #timer {
      color: rgb(49, 23, 31);
      float:right;
      font-family: fira code, monospace;
      font-size: 19vw;
      margin: 5px 0px;
    }
    #names {
      clear: both;
      color: rgb(49, 23, 31);
      font-size: 3vh;
      float: left;
      padding-left: 3vw;
    }
    li {
      line-height: 1.5em;
    }
    #docu {
      border-top: 1px solid #ccc;
      clear:both;
      color: #bbb;
      font-size: 1.5vw;
      margin-top: 40px;
      padding-top: 5px;
    }
    p {
      padding: 0px;
      margin: 2px 0px;
    }
    .al {
      animation: pulse .5s ease infinite alternate;
      color:rgb(234, 0, 41)
    }
    @keyframes pulse {
      0% {opacity: 0;}
      100% {opacity: 1;}
    }
  </style>
</head>

<body>
  <div id="content">
    <h3 id="inp"><input type="text" id="inpMaxTime" /> min</h3>
    <h3 id="head">Timebox</h3>
    <ol id="names"></ol>
    <h1 id="timer"></h1>
    <div id="docu">
      <p>[s] = shuffles names // [space] restarts timer</p>
      <p>url-parameters: ?names=comma,separated,list&time=3</p>
      <p>2022 Maik Lindner</p>
    </div>
  </div>
  <script>
    const parValues = new URLSearchParams(window.location.search)
    const parNames = (parValues.get('names') || 'Donatello,Leonardo,Michelangelo,Raphael').split(',')
    var parMaxTime = parValues.get('time') || 3

    var
      inpMaxTime = document.getElementById('inpMaxTime'),
      docNames = document.getElementById('names'),
      docTimer = document.getElementById("timer"),
      t0 = new Date,
      d = []

    document.addEventListener('keyup', event => {
      switch(event.code) {
        case 'Space':
          t0 = new Date
          break;
        case 'KeyS':
          docNames.innerHTML = shuffleArray(parNames)
          break;
        case 'KeyB':

      }
    })

    inpMaxTime.addEventListener('keyup', event => {
      if (inpMaxTime.value === '') inpMaxTime.value = 0
      if (inpMaxTime.value > 60) inpMaxTime.value = 60
      parMaxTime = inpMaxTime.value
      resizeMaxTime()
      t0 = new Date
    })

    function resizeMaxTime() {
      inpMaxTime.style.width = parMaxTime.length + "ch";
    }

    function shuffleArray(array) {
      let
        i = 0,
        r = ''
      array.forEach(element => {
        d[i] = [Math.random(),element]
        i++
      });
      d.sort()
      d.forEach(element => {
        r = r + '<li>'+element[1]+'</li>'
      });
      return r
    }
    
    docNames.innerHTML = shuffleArray(parNames)
    inpMaxTime.value = parMaxTime // t0.toLocaleDateString("en-CA"); 
    docTimer.innerHTML = ((Math.floor(((parMaxTime*60) % 3600) / 60)<10)?'0'+Math.floor(((parMaxTime*60) % 3600) / 60):Math.floor(((parMaxTime*60) % 3600) / 60)) + ":" + ((Math.floor((parMaxTime*60) % 60)<10)?'0'+Math.floor((parMaxTime*60) % 60):Math.floor((parMaxTime*60) % 60))
    resizeMaxTime()

    var x = setInterval(function() {
      let t1 = new Date().getTime()
      let varDiff = (parMaxTime*60+1) - (t1 - t0)/1000,
        varMinutes = Math.abs(varDiff<0?Math.ceil((varDiff % 3600) / 60):Math.floor((varDiff % 3600) / 60))
        varSeconds = Math.abs(Math.floor(varDiff % 60))
        varText = ((varMinutes<10)?'0'+varMinutes:varMinutes) + ":" + ((varSeconds<10)?'0'+varSeconds:varSeconds)
      docTimer.innerHTML = '<div '+((varDiff<0)?'class="al" ':'')+'>'+varText+'</div>'

    }, 1000)

  </script>

</body>

</html>
